# Binder Java 层类结构与整体框架

## 1. Java 层初始化

以下内容大量涉及 JNI 编程基础，如果不太熟悉可以提前阅读[JNI 编程上手指南]()

Android Zygote 启动时，会调用 `AndroidRuntime::startReg` 注册一系列的 JNI 方法，其中包含了 Java 层与 Binder 相关的 JNI 方法：

```c++
// frameworks/base/core/jni/AndroidRuntime.cpp
static const RegJNIRec gRegJNI[] = {
	...
	REG_JNI(register_android_os_Binder),
	...
}

int AndroidRuntime::startReg(JNIEnv* env)
{  
    //......
    
    //注册 jni 函数
    if (register_jni_procs(gRegJNI, NELEM(gRegJNI), env) < 0) {
        env->PopLocalFrame(NULL);
        return -1;
    }
    
    //......
    return 0;
}
```

这个流程没有过多好讲的，就是注册一系列的 JNI 方法，其中 gRegJNI 是一个数组保存了一系列的待注册的 JNI 方法列表，而这其中就包括我们今天的主人公 Framework Binder 相关的JNI方法 register_android_os_Binder。

register_android_os_Binder 是一个函数指针，我们来看一下它的具体实现

```c++
// frameworks/base/core/jni/android_util_Binder.cpp

int register_android_os_Binder(JNIEnv* env)
{
    //注册Binder类的JNI方法
    if (int_register_android_os_Binder(env) < 0)
        return -1;
    //注册BinderInteral类的JNI方法
    if (int_register_android_os_BinderInternal(env) < 0)
        return -1;
    //注册BinderProxy类的JNI方法
    if (int_register_android_os_BinderProxy(env) < 0)
        return -1;

    //......
    return 0;
}
```
